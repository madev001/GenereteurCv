
version: '3'

services:
    
    #service 1: database
    db:
      image: mysql:latest
      hostname: db
      container_name: db
      environment:
        MYSQL_DATABASE: 'cv'
        MYSQL_USER: 'moncv'
        MYSQL_PASSWORD: 'moncv'
        MYSQL_ROOT_PASSWORD: 'root'
        MYSQL_ROOT_HOST: '%'
      ports:
        - "3306:3306"
      restart: always
      
    
    
    #service 2 : image de l'application
    cv:                        
      image: cvimage               #nom de l'image 
      container_name: cv-app  #Nom du conteneur 
      build:
        context: .                          #docker location
        dockerfile: Dockerfile              
      ports:
        - "8084:8081"   
      links:
      - db:db
      environment: #les varriables d'environement spring
        SPRING_DATASOURCE_URL: jdbc:mysql://db:3306/cv?useSSL=false
        SPRING_DATASOURCE_USERNAME: moncv
        SPRING_DATASOURCE_PASSWORD: moncv                
      restart: always
        
      depends_on:                           
        - db                                #Cette image depend de l'image precedente de la base de donn√©es
      